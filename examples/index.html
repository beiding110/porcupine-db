<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<title>porcupine-db example</title>
	<meta name="keywords" content="">
	<meta name="description" content="">
	<style>
		table{width:100%; border-left:1px solid #aaa; border-top:1px solid #aaa;}
		td, th{border-right:1px solid #aaa; border-bottom:1px solid #aaa;}
	</style>
</head>
<body>
	<div>
		<button onclick="resetHandler()">复原数据（使用localstorage）</button>
	</div>
	<div>
		<button onclick="insertHandler()">插入数据</button>
	</div>
	<div>
		<button onclick="delHandler()">删除数据</button>
		<button onclick="delAllHandler()">删除全部数据</button>
	</div>
	<div>
		<button onclick="updateHandler()">更新数据</button>
		<button onclick="updateAllHandler()">更新全部数据</button>
	</div>
	<div>
		<button onclick="selectHandler()">筛选数据</button>
		<button onclick="selectAllHandler()">筛选全部数据</button>
	</div>
	<div>
		<h1>table表中数据</h1>	
		<div id="table"></div>
	</div>

	<div>
		<h1>筛选的数据</h1>	
		<div id="select"></div>
	</div>


	<script type="text/javascript" src="./js/index.js"></script>
	<script type="text/javascript" src="../index.js"></script>
	<script type="text/javascript">
		var db = new Pdb;
		db.create.table('table').run();

		function insertHandler() {
			db.insert.into('table').value([{
				name: 'insert' + ((Math.random() + '').slice(2, 5)),
				age: Math.round(Math.random() * 10)
			},{
				name: 'insert' + ((Math.random() + '').slice(2, 5)),
				age: Math.round(Math.random() * 10)
			}]).run();

			updateTableTableView();
		};

		function delHandler() {
			db.delete.from('table').where(function(item) {
				return item.name === 'yzh';
			}).run();

			updateTableTableView();
		};
		function delAllHandler() {
			db.delete.from('table');

			updateTableTableView();
		}

		function updateHandler() {
			db.update('table').set({
				age: 312
			}).where(function(item) {
				return item.name === 'yzh'
			}).run();

			updateTableTableView();
		};
		function updateAllHandler() {
			db.update('table').set({
				age: 666
			}).run();

			updateTableTableView();
		};

		function selectHandler() {
			var rows = db.select(['age', 'name']).from('table').where(function(item) {
				return item.name === 'yzh';
			}).run();

			updateSelectTableView(rows);
		};
		function selectAllHandler() {
			var rows = db.select('name').from('table').run();

			updateSelectTableView(rows);
		}

		function updateTableTableView() {
			var table = db.select().from('table').run();
			document.querySelector('#table').innerHTML = renderTable(table)
		};
		updateTableTableView();

		function updateSelectTableView(rows) {
			document.querySelector('#select').innerHTML = renderTable(rows)
		}

		function resetHandler() {
			window.localStorage.table = '%5B%7B%22name%22%3A%22yzh%22%2C%22age%22%3A123%2C%22rowguid%22%3A%227ad0ad0a-09a3-2fd2-3ebe-d59fe759bf7f%22%7D%2C%7B%22name%22%3A%22zh%22%2C%22age%22%3A123%2C%22rowguid%22%3A%2259367e67-3706-46cf-9e39-069ab16e0052%22%7D%2C%7B%22name%22%3A%22dcj%22%2C%22age%22%3A123%2C%22rowguid%22%3A%2235108562-0835-6585-6e2b-46426c1d8774%22%7D%2C%7B%22name%22%3A%22dgw%22%2C%22age%22%3A123%2C%22rowguid%22%3A%22d8dfca0e-0ba4-cd81-69bc-87db75fb2940%22%7D%2C%7B%22name%22%3A%22zw%22%2C%22age%22%3A123%2C%22rowguid%22%3A%221d72a3b7-8ff0-4ac3-2a60-3d57ed029795%22%7D%2C%7B%22name%22%3A%22dqs%22%2C%22age%22%3A123%2C%22rowguid%22%3A%22f3b34ec8-b98e-3a70-85f3-70b5bd9b9bf5%22%7D%2C%7B%22name%22%3A%22wkh%22%2C%22age%22%3A123%2C%22rowguid%22%3A%224be51aab-c9ba-58e7-5851-2f90972fe6eb%22%7D%2C%7B%22name%22%3A%22llc%22%2C%22age%22%3A123%2C%22rowguid%22%3A%22199a3eca-557d-2784-ba23-27154d42f1fb%22%7D%5D';
			updateTableTableView();
		};
    </script>
</body>
</html>
